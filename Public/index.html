<!DOCTYPE html>
<html lang="zh-TW">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨‹å¼æ•™å­¸å¹³å° - å­¸ç”Ÿè¨»å†Šç³»çµ±</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="stylesheet" href="visual.css">
    <link rel="stylesheet" href="animations.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="container">
      <div class="registration-card">
        <div class="header">
          <div class="logo">
            <i class="fas fa-code"></i>
            <h1>ç¨‹å¼æ•™å­¸å¹³å°</h1>
          </div>
          <p class="subtitle">æ­¡è¿åŠ å…¥æˆ‘å€‘çš„ç¨‹å¼å­¸ç¿’ç¤¾ç¾¤</p>
        </div>

        <form id="registrationForm" class="registration-form">
          <div class="form-section">
            <h3><i class="fas fa-user"></i> åŸºæœ¬è³‡æ–™</h3>

            <div class="form-group">
              <label for="studentId">å­¸è™Ÿ *</label>
              <input type="text" id="studentId" name="studentId" placeholder="è«‹è¼¸å…¥8ä½æ•¸å­—" maxlength="8" pattern="[0-9]{8}"
                required>
              <span class="error-message" id="studentIdError"></span>
            </div>

            <div class="form-group">
              <label for="fullName">å§“å *</label>
              <input type="text" id="fullName" name="fullName" required>
              <span class="error-message" id="fullNameError"></span>
            </div>

            <div class="form-group">
              <label for="email">é›»å­éƒµä»¶ *</label>
              <input type="email" id="email" name="email" required>
              <span class="error-message" id="emailError"></span>
            </div>

            <div class="form-group">
              <label for="phone">è¯çµ¡é›»è©± *</label>
              <input type="tel" id="phone" name="phone" required>
              <span class="error-message" id="phoneError"></span>
            </div>

            <div class="form-group">
              <label for="birthDate">å‡ºç”Ÿæ—¥æœŸ *</label>
              <input type="date" id="birthDate" name="birthDate" required>
              <span class="error-message" id="birthDateError"></span>
            </div>

            <div class="form-group">
              <label for="gender">æ€§åˆ¥ *</label>
              <select id="gender" name="gender" required>
                <option value="">è«‹é¸æ“‡æ€§åˆ¥</option>
                <option value="male">ç”·</option>
                <option value="female">å¥³</option>
                <option value="other">å…¶ä»–</option>
              </select>
              <span class="error-message" id="genderError"></span>
            </div>
          </div>

          <div class="form-section">
            <h3><i class="fas fa-graduation-cap"></i> å­¸ç¿’è³‡è¨Š</h3>

            <div class="form-group">
              <label for="department">ç§‘ç³» *</label>
              <select id="department" name="department" required>
                <option value="">è«‹é¸æ“‡ç§‘ç³»</option>
                <optgroup label="è³‡è¨Šç›¸é—œç§‘ç³»">
                  <option value="è³‡è¨Šå·¥ç¨‹ç³»">è³‡è¨Šå·¥ç¨‹ç³»</option>
                  <option value="è³‡è¨Šç®¡ç†ç³»">è³‡è¨Šç®¡ç†ç³»</option>
                  <option value="è³‡è¨Šç§‘å­¸ç³»">è³‡è¨Šç§‘å­¸ç³»</option>
                  <option value="è³‡è¨Šç¶²è·¯ç³»">è³‡è¨Šç¶²è·¯ç³»</option>
                  <option value="è³‡è¨Šå‚³æ’­ç³»">è³‡è¨Šå‚³æ’­ç³»</option>
                  <option value="é›»è…¦ç§‘å­¸ç³»">é›»è…¦ç§‘å­¸ç³»</option>
                  <option value="è»Ÿé«”å·¥ç¨‹ç³»">è»Ÿé«”å·¥ç¨‹ç³»</option>
                  <option value="æ•¸æ“šç§‘å­¸ç³»">æ•¸æ“šç§‘å­¸ç³»</option>
                  <option value="äººå·¥æ™ºæ…§ç³»">äººå·¥æ™ºæ…§ç³»</option>
                  <option value="æ•¸ä½åª’é«”è¨­è¨ˆç³»">æ•¸ä½åª’é«”è¨­è¨ˆç³»</option>
                  <option value="è³‡è¨Šå®‰å…¨ç³»">è³‡è¨Šå®‰å…¨ç³»</option>
                </optgroup>
                <optgroup label="å·¥ç¨‹ç§‘ç³»">
                  <option value="é›»æ©Ÿå·¥ç¨‹ç³»">é›»æ©Ÿå·¥ç¨‹ç³»</option>
                  <option value="é›»å­å·¥ç¨‹ç³»">é›»å­å·¥ç¨‹ç³»</option>
                  <option value="æ©Ÿæ¢°å·¥ç¨‹ç³»">æ©Ÿæ¢°å·¥ç¨‹ç³»</option>
                  <option value="å·¥æ¥­å·¥ç¨‹ç³»">å·¥æ¥­å·¥ç¨‹ç³»</option>
                  <option value="åœŸæœ¨å·¥ç¨‹ç³»">åœŸæœ¨å·¥ç¨‹ç³»</option>
                  <option value="åŒ–å­¸å·¥ç¨‹ç³»">åŒ–å­¸å·¥ç¨‹ç³»</option>
                  <option value="ææ–™å·¥ç¨‹ç³»">ææ–™å·¥ç¨‹ç³»</option>
                </optgroup>
                <optgroup label="å•†ç®¡ç§‘ç³»">
                  <option value="ä¼æ¥­ç®¡ç†ç³»">ä¼æ¥­ç®¡ç†ç³»</option>
                  <option value="æœƒè¨ˆç³»">æœƒè¨ˆç³»</option>
                  <option value="è²¡å‹™é‡‘èç³»">è²¡å‹™é‡‘èç³»</option>
                  <option value="åœ‹éš›è²¿æ˜“ç³»">åœ‹éš›è²¿æ˜“ç³»</option>
                  <option value="è¡ŒéŠ·ç®¡ç†ç³»">è¡ŒéŠ·ç®¡ç†ç³»</option>
                  <option value="äººåŠ›è³‡æºç®¡ç†ç³»">äººåŠ›è³‡æºç®¡ç†ç³»</option>
                </optgroup>
                <optgroup label="å…¶ä»–ç§‘ç³»">
                  <option value="æ‡‰ç”¨çµ±è¨ˆç³»">æ‡‰ç”¨çµ±è¨ˆç³»</option>
                  <option value="å»ºç¯‰ç³»">å»ºç¯‰ç³»</option>
                  <option value="å…¶ä»–">å…¶ä»–</option>
                </optgroup>
              </select>
              <span class="error-message" id="departmentError"></span>
            </div>

            <div class="form-group">
              <label for="grade">å¹´ç´š *</label>
              <select id="grade" name="grade" required>
                <option value="">è«‹é¸æ“‡å¹´ç´š</option>
                <option value="1">ä¸€å¹´ç´š</option>
                <option value="2">äºŒå¹´ç´š</option>
                <option value="3">ä¸‰å¹´ç´š</option>
                <option value="4">å››å¹´ç´š</option>
                <option value="graduate">ç ”ç©¶æ‰€</option>
              </select>
              <span class="error-message" id="gradeError"></span>
            </div>

            <div class="form-group">
              <label for="programmingLevel">ç¨‹å¼è¨­è¨ˆç¶“é©— *</label>
              <select id="programmingLevel" name="programmingLevel" required>
                <option value="">è«‹é¸æ“‡ç¶“é©—ç­‰ç´š</option>
                <option value="beginner">åˆå­¸è€… (ç„¡ç¶“é©—)</option>
                <option value="basic">åŸºç¤ (1-6å€‹æœˆ)</option>
                <option value="intermediate">ä¸­ç´š (6å€‹æœˆ-2å¹´)</option>
                <option value="advanced">é«˜ç´š (2å¹´ä»¥ä¸Š)</option>
              </select>
              <span class="error-message" id="programmingLevelError"></span>
            </div>

            <div class="form-group">
              <label for="learningGoals">å­¸ç¿’ç›®æ¨™</label>
              <textarea id="learningGoals" name="learningGoals" rows="4" placeholder="è«‹æè¿°æ‚¨çš„å­¸ç¿’ç›®æ¨™å’ŒæœŸæœ›..."></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3><i class="fas fa-lock"></i> å¸³æˆ¶è¨­å®š</h3>

            <div class="form-group">
              <label for="username">ä½¿ç”¨è€…åç¨± *</label>
              <input type="text" id="username" name="username" required>
              <span class="error-message" id="usernameError"></span>
            </div>

            <div class="form-group">
              <label for="password">å¯†ç¢¼ *</label>
              <div class="password-requirements">
                <small><strong>å¯†ç¢¼è¦å‰‡ï¼š</strong></small>
                <ul class="password-rules">
                  <li>è‡³å°‘8å€‹å­—ç¬¦</li>
                  <li>è‡³å°‘åŒ…å«8å€‹è‹±æ–‡å­—æ¯å’Œæ•¸å­—çµ„åˆ</li>
                  <li>ç¬¬ä¸€å€‹å­—æ¯å¿…é ˆæ˜¯å¤§å¯«</li>
                  <li>å¿…é ˆåŒ…å«1å€‹ç‰¹æ®Šç¬¦è™Ÿ (# æˆ– $ æˆ– * æˆ– @)</li>
                </ul>
              </div>
              <div class="password-input">
                <input type="password" id="password" name="password" required>
                <button type="button" class="toggle-password" onclick="togglePassword('password')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <span class="error-message" id="passwordError"></span>
            </div>

            <div class="form-group">
              <label for="confirmPassword">ç¢ºèªå¯†ç¢¼ *</label>
              <div class="password-input">
                <input type="password" id="confirmPassword" name="confirmPassword" required>
                <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <span class="error-message" id="confirmPasswordError"></span>
            </div>
          </div>

          <div class="form-section">
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                <span class="checkmark"></span>
                æˆ‘åŒæ„ <a href="#" class="link">æœå‹™æ¢æ¬¾</a> å’Œ <a href="#" class="link">éš±ç§æ”¿ç­–</a> *
              </label>
              <span class="error-message" id="agreeTermsError"></span>
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="newsletter" name="newsletter">
                <span class="checkmark"></span>
                è¨‚é–±èª²ç¨‹æ›´æ–°å’Œå­¸ç¿’è³‡æºé€šçŸ¥
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="resetForm()">
              <i class="fas fa-undo"></i> é‡è¨­
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-user-plus"></i> è¨»å†Šå¸³æˆ¶
            </button>
          </div>
        </form>

        <div class="login-link">
          <p>å·²ç¶“æœ‰å¸³æˆ¶äº†ï¼Ÿ <a href="login.html" class="link">ç«‹å³ç™»å…¥</a></p>
        </div>

        <div class="login-link" style="margin-top: 20px;">
          <p style="font-size: 0.85rem; color: #999;">
            é‡åˆ°å•é¡Œï¼Ÿ <a href="clear-data.html" class="link" style="color: #e74c3c;">æ¸…é™¤æ‰€æœ‰è³‡æ–™</a>
          </p>
        </div>
      </div>
    </div>

    <script src="../Private/database/secureDB.js"></script>
    <script src="../Private/database/userRepository.js"></script>
    <script src="../Private/database/sessionRepository.js"></script>
    <script src="../Private/data/coursesData.js"></script>
    <script src="../Private/auth/api.js"></script>
    <script src="../Private/auth/session.js"></script>
    <script src="../Private/favorites/favoritesAPI.js"></script>
    <script src="clearData.js"></script>
    <script src="animations.js"></script>
    <script>

      // å¯†ç¢¼é¡¯ç¤º/éš±è—åˆ‡æ›
      function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const button = field.nextElementSibling;
        const icon = button.querySelector('i');

        if (field.type === 'password') {
          field.type = 'text';
          icon.className = 'fas fa-eye-slash';
        } else {
          field.type = 'password';
          icon.className = 'fas fa-eye';
        }
      }

      // è¡¨å–®é©—è­‰
      function validateForm() {
        let isValid = true;
        const errors = {};

        // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤è¨Šæ¯
        document.querySelectorAll('.error-message').forEach(error => {
          error.textContent = '';
        });

        // å­¸è™Ÿé©—è­‰
        const studentId = document.getElementById('studentId').value.trim();
        if (!studentId) {
          errors.studentId = 'è«‹è¼¸å…¥å­¸è™Ÿ';
          isValid = false;
        } else if (!/^\d{8}$/.test(studentId)) {
          errors.studentId = 'å­¸è™Ÿå¿…é ˆç‚º8ä½æ•¸å­—';
          isValid = false;
        }

        // å§“åé©—è­‰
        const fullName = document.getElementById('fullName').value.trim();
        if (!fullName) {
          errors.fullName = 'è«‹è¼¸å…¥å§“å';
          isValid = false;
        } else if (fullName.length < 2) {
          errors.fullName = 'å§“åè‡³å°‘éœ€è¦2å€‹å­—ç¬¦';
          isValid = false;
        }

        // é›»å­éƒµä»¶é©—è­‰
        const email = document.getElementById('email').value.trim();
        if (!email) {
          errors.email = 'è«‹è¼¸å…¥é›»å­éƒµä»¶';
          isValid = false;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          errors.email = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶æ ¼å¼';
          isValid = false;
        }

        // é›»è©±é©—è­‰
        const phone = document.getElementById('phone').value.trim();
        if (!phone) {
          errors.phone = 'è«‹è¼¸å…¥è¯çµ¡é›»è©±';
          isValid = false;
        } else if (!/^[0-9\-\+\(\)\s]{8,15}$/.test(phone)) {
          errors.phone = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»è©±è™Ÿç¢¼';
          isValid = false;
        }

        // å‡ºç”Ÿæ—¥æœŸé©—è­‰
        const birthDate = document.getElementById('birthDate').value;
        if (!birthDate) {
          errors.birthDate = 'è«‹é¸æ“‡å‡ºç”Ÿæ—¥æœŸ';
          isValid = false;
        } else {
          const today = new Date();
          const birth = new Date(birthDate);
          const age = today.getFullYear() - birth.getFullYear();
          if (age < 16 || age > 100) {
            errors.birthDate = 'å¹´é½¡å¿…é ˆåœ¨16-100æ­²ä¹‹é–“';
            isValid = false;
          }
        }

        // å¯†ç¢¼é©—è­‰
        const password = document.getElementById('password').value;
        if (!password) {
          errors.password = 'è«‹è¼¸å…¥å¯†ç¢¼';
          isValid = false;
        } else {
          // æª¢æŸ¥å¯†ç¢¼è¦å‰‡
          const hasMinLength = password.length >= 8;
          const hasUpperCase = /[A-Z]/.test(password);
          const hasLowerCase = /[a-z]/.test(password);
          const hasNumbers = /\d/.test(password);
          const hasSpecialChar = /[#$*@]/.test(password);
          const startsWithCapital = /^[A-Z]/.test(password);
          const hasAlphanumeric = /[A-Za-z0-9]/.test(password);

          // è¨ˆç®—è‹±æ–‡å­—æ¯å’Œæ•¸å­—çš„ç¸½æ•¸
          const alphanumericCount = (password.match(/[A-Za-z0-9]/g) || []).length;

          if (!hasMinLength) {
            errors.password = 'å¯†ç¢¼è‡³å°‘éœ€è¦8å€‹å­—ç¬¦';
            isValid = false;
          } else if (!startsWithCapital) {
            errors.password = 'å¯†ç¢¼ç¬¬ä¸€å€‹å­—æ¯å¿…é ˆæ˜¯å¤§å¯«';
            isValid = false;
          } else if (alphanumericCount < 8) {
            errors.password = 'å¯†ç¢¼è‡³å°‘éœ€è¦åŒ…å«8å€‹è‹±æ–‡å­—æ¯å’Œæ•¸å­—çµ„åˆ';
            isValid = false;
          } else if (!hasSpecialChar) {
            errors.password = 'å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘1å€‹ç‰¹æ®Šç¬¦è™Ÿ (# æˆ– $ æˆ– * æˆ– @)';
            isValid = false;
          } else if (!hasUpperCase || !hasLowerCase || !hasNumbers) {
            errors.password = 'å¯†ç¢¼å¿…é ˆåŒ…å«å¤§å°å¯«å­—æ¯å’Œæ•¸å­—';
            isValid = false;
          }
        }

        // ç¢ºèªå¯†ç¢¼é©—è­‰
        const confirmPassword = document.getElementById('confirmPassword').value;
        if (!confirmPassword) {
          errors.confirmPassword = 'è«‹ç¢ºèªå¯†ç¢¼';
          isValid = false;
        } else if (password !== confirmPassword) {
          errors.confirmPassword = 'å¯†ç¢¼ä¸ä¸€è‡´';
          isValid = false;
        }

        // æœå‹™æ¢æ¬¾åŒæ„é©—è­‰
        if (!document.getElementById('agreeTerms').checked) {
          errors.agreeTerms = 'è«‹åŒæ„æœå‹™æ¢æ¬¾å’Œéš±ç§æ”¿ç­–';
          isValid = false;
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        Object.keys(errors).forEach(field => {
          const errorElement = document.getElementById(field + 'Error');
          if (errorElement) {
            errorElement.textContent = errors[field];
          }
        });

        return isValid;
      }

      // è¡¨å–®æäº¤è™•ç†
      document.getElementById('registrationForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        if (validateForm()) {
          // æ”¶é›†è¡¨å–®è³‡æ–™
          const formData = new FormData(this);
          const data = {};

          // åŸºæœ¬è³‡æ–™
          data.studentId = formData.get('studentId');
          data.fullName = formData.get('fullName');
          data.email = formData.get('email');
          data.phone = formData.get('phone');
          data.birthDate = formData.get('birthDate');
          data.gender = formData.get('gender');

          // å­¸ç¿’è³‡è¨Š
          data.department = formData.get('department');
          data.grade = formData.get('grade');
          data.programmingLevel = formData.get('programmingLevel');
          data.learningGoals = formData.get('learningGoals');

          // å¸³æˆ¶è¨­å®š
          data.username = formData.get('username');
          data.password = formData.get('password');
          data.newsletter = formData.get('newsletter') === 'on';

          try {
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è¨»å†Šä¸­...';
            submitBtn.disabled = true;

            // ä½¿ç”¨èªè­‰ API è¨»å†Š
            const result = await window.authAPI.signup(data);

            if (result.user_id && result.token) {
              // Signup å·²ç¶“å‰µå»ºäº† token å’Œ sessionï¼Œç›´æ¥è¨­ç½® session manager
              window.sessionManager.token = result.token;
              window.sessionManager.currentUser = result.user;
              localStorage.setItem('auth_token', result.token);

              // è§¸ç™¼ç™»å…¥äº‹ä»¶
              window.sessionManager.dispatchEvent('login', { user: result.user });

              alert('è¨»å†ŠæˆåŠŸï¼æ­¡è¿åŠ å…¥ç¨‹å¼æ•™å­¸å¹³å°ï¼');
              // è·³è½‰åˆ°å„€è¡¨æ¿
              window.location.href = 'dashboard.html';
            } else {
              throw new Error('è¨»å†Šå¤±æ•—');
            }
          } catch (error) {
            console.error('è¨»å†ŠéŒ¯èª¤:', error);
            alert('è¨»å†Šå¤±æ•—ï¼š' + error.message);
          } finally {
            // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          }
        }
      });

      // é‡è¨­è¡¨å–®
      function resetForm() {
        document.getElementById('registrationForm').reset();
        document.querySelectorAll('.error-message').forEach(error => {
          error.textContent = '';
        });
      }

      // å¯¦æ™‚å­¸è™Ÿé©—è­‰
      function validateStudentIdRealTime() {
        const studentIdInput = document.getElementById('studentId');
        const studentId = studentIdInput.value.trim();
        const errorElement = document.getElementById('studentIdError');

        if (studentId.length === 0) {
          errorElement.textContent = '';
          return;
        }

        // æª¢æŸ¥é•·åº¦
        if (studentId.length < 8) {
          errorElement.textContent = `å­¸è™Ÿå¿…é ˆç‚º8ä½æ•¸å­— (ç›®å‰ï¼š${studentId.length}ä½)`;
          return;
        }

        if (studentId.length > 8) {
          errorElement.textContent = 'å­¸è™Ÿè¶…é8ä½æ•¸å­—';
          return;
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºç´”æ•¸å­—
        if (!/^\d{8}$/.test(studentId)) {
          errorElement.textContent = 'å­¸è™Ÿåªèƒ½åŒ…å«æ•¸å­—';
          return;
        }

        // æ¸…ç©ºéŒ¯èª¤è¨Šæ¯å¦‚æœæ ¼å¼æ­£ç¢º
        if (/^\d{8}$/.test(studentId)) {
          errorElement.textContent = '';
        }
      }

      // å­¸è™Ÿè¼¸å…¥é™åˆ¶ï¼šåªå…è¨±æ•¸å­—
      function restrictStudentIdInput(event) {
        const input = event.target;
        // åªå…è¨±æ•¸å­—ï¼Œä¸¦ä¸”é™åˆ¶æœ€å¤š8ä½
        input.value = input.value.replace(/[^0-9]/g, '');
        if (input.value.length > 8) {
          input.value = input.value.substring(0, 8);
        }
      }

      // å¯¦æ™‚å¯†ç¢¼é©—è­‰
      function validatePasswordRealTime() {
        const password = document.getElementById('password').value;
        const errorElement = document.getElementById('passwordError');

        if (password.length === 0) {
          errorElement.textContent = '';
          return;
        }

        // æª¢æŸ¥å¯†ç¢¼è¦å‰‡
        const hasMinLength = password.length >= 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[#$*@]/.test(password);
        const startsWithCapital = /^[A-Z]/.test(password);

        // è¨ˆç®—è‹±æ–‡å­—æ¯å’Œæ•¸å­—çš„ç¸½æ•¸
        const alphanumericCount = (password.match(/[A-Za-z0-9]/g) || []).length;

        let errorMessage = '';

        if (!hasMinLength) {
          errorMessage = 'å¯†ç¢¼è‡³å°‘éœ€è¦8å€‹å­—ç¬¦';
        } else if (!startsWithCapital) {
          errorMessage = 'å¯†ç¢¼ç¬¬ä¸€å€‹å­—æ¯å¿…é ˆæ˜¯å¤§å¯«';
        } else if (alphanumericCount < 8) {
          errorMessage = 'å¯†ç¢¼è‡³å°‘éœ€è¦åŒ…å«8å€‹è‹±æ–‡å­—æ¯å’Œæ•¸å­—çµ„åˆ';
        } else if (!hasSpecialChar) {
          errorMessage = 'å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘1å€‹ç‰¹æ®Šç¬¦è™Ÿ (# æˆ– $ æˆ– * æˆ– @)';
        } else if (!hasUpperCase || !hasLowerCase || !hasNumbers) {
          errorMessage = 'å¯†ç¢¼å¿…é ˆåŒ…å«å¤§å°å¯«å­—æ¯å’Œæ•¸å­—';
        }

        errorElement.textContent = errorMessage;
      }

      // åˆ‡æ›èª²ç¨‹æ”¶è—ç‹€æ…‹
      function toggleCourseFavorite(courseId, event) {
        event.preventDefault();
        event.stopPropagation();

        // å¦‚æœç”¨æˆ¶å·²ç™»å…¥ï¼Œå¯ä»¥æ·»åŠ åˆ°æ”¶è—
        if (window.sessionManager.isLoggedIn()) {
          const user = window.sessionManager.getCurrentUser();
          const result = window.favoritesAPI.toggleFavorite(user.id, courseId);

          if (result.success) {
            updateFavoriteButton(courseId, result.success);
            showNotification(result.message, 'success');
          } else {
            showNotification(result.message, 'error');
          }
        } else {
          // å¦‚æœæœªç™»å…¥ï¼Œæç¤ºå…ˆç™»å…¥
          showNotification('è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æ”¶è—åŠŸèƒ½', 'info');
        }
      }

      // æ›´æ–°æ”¶è—æŒ‰éˆ•ç‹€æ…‹
      function updateFavoriteButton(courseId, isFavorite) {
        const button = document.querySelector(`button[onclick*="${courseId}"]`);
        if (button) {
          if (isFavorite) {
            button.classList.add('active');
            button.innerHTML = '<i class="fas fa-heart"></i>';
          } else {
            button.classList.remove('active');
            button.innerHTML = '<i class="far fa-heart"></i>';
          }
        }
      }

      // é¡¯ç¤ºé€šçŸ¥
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;

        document.body.appendChild(notification);

        // é¡¯ç¤ºå‹•ç•«
        setTimeout(() => notification.classList.add('show'), 100);

        // è‡ªå‹•ç§»é™¤
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function () {
        // æª¢æŸ¥æ˜¯å¦å·²ç¶“ç™»å…¥
        if (window.sessionManager.isLoggedIn()) {
          alert('æ‚¨å·²ç¶“ç™»å…¥ï¼Œæ­£åœ¨è·³è½‰åˆ°å„€è¡¨æ¿...');
          window.location.href = 'dashboard.html';
          return;
        }

        // è¼‰å…¥èª²ç¨‹é¸é …
        loadCourseSelection();

        // æ·»åŠ å¯¦æ™‚å­¸è™Ÿé©—è­‰
        document.getElementById('studentId').addEventListener('input', validateStudentIdRealTime);
        document.getElementById('studentId').addEventListener('keypress', restrictStudentIdInput);
        document.getElementById('studentId').addEventListener('paste', restrictStudentIdInput);

        // æ·»åŠ å¯¦æ™‚å¯†ç¢¼é©—è­‰
        document.getElementById('password').addEventListener('input', validatePasswordRealTime);

        // é¡¯ç¤ºæ¸…é™¤è³‡æ–™å·¥å…·çš„æç¤º
        console.log('%cğŸ§¹ æ¸…é™¤è³‡æ–™å·¥å…·å·²è¼‰å…¥ï¼', 'color: #e74c3c; font-weight: bold; font-size: 16px;');
        console.log('%cğŸ’¡ åœ¨æ§åˆ¶å°è¼¸å…¥ clearAllStoredData() æ¸…é™¤æ‰€æœ‰è³‡æ–™', 'color: #667eea; font-size: 14px;');
        console.log('%cğŸ’¡ æˆ–åœ¨æ§åˆ¶å°è¼¸å…¥ showClearDataHelp() æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤', 'color: #667eea; font-size: 14px;');
      });
    </script>
  </body>

</html>